<html>
<head>
<title>Performance Report</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<script type="text/javascript" src="validate.js"></script>
<link rel="stylesheet" type="text/css" href="style1.css" />
</head>

<body>

<?php
/*
rptPerformance.php
reports greatest/worst single game performances in a number of categories
*/


//left navbar / banner
include_once("header.php");
require_once("db_login.php");
require_once("points.inc.php");
require_once("grade.php");
require_once("statPower.php");

 
//create connection obj
		$connection = mysql_connect($db_host, $db_username, $db_password);
		if(!$connection)
        {
            die ("Could not connect to the database: <br />". mysql_error());
        }
        
        
        $db_select = mysql_select_db($db_database, $connection);
        if (!$db_select)
        {
            die ("Could not select the database: <br />". mysql_error());
        }
		

		
$rptOptions = array(
"Most Lines", 		
"Most Time",  		
"Least Time", 		
"Highest LPS", 		
"Highest LPS > 99",
"Highest LPS > 199",
"Worst LPS > 0", 	
//"Highest Power", 	
"Longest Shutout",  
"Shortest Oh-Oh",
"Shortest 'S'",
"Longest 'S'",
"High LPS - 4th Wrank",
"High LPS - 4th Erank",
"Low LPS - 1st Wrank"	
); 

$rptNumRecs = array(
10,
25,
50,
100);

?>

<div class="report">
<h1>Individual Performance Report</h1>
<form name="criteria" method="get" action="rptPerformance.php">
<table align="center">
<tr><td>Report Options:</td><td>
<select name="rptOption">

<?php

foreach ($rptOptions as $i)
{	
	if ($i == $_GET["rptOption"])
	{
		echo '<option value="' . $i . '" selected>' . $i . '</option>';
	}
	else
	{
		echo '<option value="' . $i . '">' . $i . '</option>';
	}
}

?>

</select></td></tr>
<tr><td># of Records:</td><td>
<select name="rptNumRecs">

<?php

foreach ($rptNumRecs as $n)
{
	if($n == $_GET["rptNumRecs"])
	{
		echo '<option values="' . $n . '" selected>' . $n . '</option>';
	}
	else
	{
		echo '<option values="' . $n . '">' . $n . '</option>';
	}
}

?>

</select></td></tr>
<tr><td colspan="2" align="center"><input type="submit" value="Generate"></form></td></tr>
</table>
</div>


<!-- REPORT BODY -->
<div class="report">
<?php

if (isset($_GET["rptOption"]))
{
$rptOption = $_GET["rptOption"];
$rptRecs = $_GET["rptNumRecs"];

	//get query string for each report
	switch ($rptOption)
	{
		case "Most Lines" :
			$select = "
			SELECT * 
			FROM pmext pm 
			ORDER BY pm.lines DESC 
			LIMIT " . $rptRecs;
		break;
	
		case "Most Time" :
			$select = "
			SELECT * 
			FROM pmext pm 
			ORDER BY pm.time DESC 
			LIMIT " . $rptRecs;
		break;
		
		case "Least Time" :
			$select = "
			SELECT * 
			FROM pmext pm 
			ORDER BY pm.time ASC 
			LIMIT " . $rptRecs;
		break;
		
		case "Highest LPS" :
			$select = "
			SELECT * 
			FROM pmext pm 
			ORDER BY pm.lps DESC 
			LIMIT " . $rptRecs;
		break;
		
		case "Highest LPS > 99" :
			$select = "
			SELECT * 
			FROM pmext pm 
			WHERE pm.lines > 99
			ORDER BY pm.lps DESC 
			LIMIT " . $rptRecs;
		break;
		
		case "Highest LPS > 199" :
			$select = "
			SELECT * 
			FROM pmext pm 
			WHERE pm.lines > 199
			ORDER BY pm.lps DESC 
			LIMIT " . $rptRecs;
		break;
		
		case "Worst LPS > 0" :
			$select = "
			SELECT * 
			FROM pmext pm 
			WHERE pm.lines > 0
			ORDER BY pm.lps ASC 
			LIMIT " . $rptRecs;
		break;
		
		case "Highest Power" :
		
		break;
		
		case "Longest Shutout" :
			$select = "
			SELECT * 
			FROM pmext pm 
			WHERE pm.lines = 0
			ORDER BY pm.time DESC 
			LIMIT " . $rptRecs;
		break;
		
		case "Shortest Oh-Oh" :
			$select = "
			SELECT * 
			FROM pmext pm 
			WHERE pm.lines = 0
			ORDER BY pm.time ASC
			LIMIT " . $rptRecs;
		break;
		
		case "Shortest 'S'" :
			$select = "
			SELECT * 
			FROM pmext pm 
			WHERE pm.lps >= 1
			ORDER BY pm.time ASC, pm.lps DESC
			LIMIT " . $rptRecs;
		break;
		
		case "Longest 'S'" :
			$select = "
			SELECT * 
			FROM pmext pm 
			WHERE pm.lps >= 1
			ORDER BY pm.time DESC, pm.lps DESC
			LIMIT " . $rptRecs;
		break;
		
		case "High LPS - 4th Wrank":
			$select = "
			SELECT * 
			FROM pmext pm 
			WHERE pm.wrank = 4
			ORDER BY pm.lps DESC
			LIMIT " . $rptRecs;
		break;
		
		case "High LPS - 4th Erank":
			$select = "
			SELECT * 
			FROM pmext pm 
			WHERE pm.erank = 4
			ORDER BY pm.lps DESC
			LIMIT " . $rptRecs;
		
		break;
		
		case "Low LPS - 1st Wrank":
			$select = "
			SELECT * 
			FROM pmext pm 
			WHERE pm.wrank = 1
			ORDER BY pm.lps ASC
			LIMIT " . $rptRecs;
		break;
		
		default :
			$select = "
			SELECT * 
			FROM pmext pm 
			WHERE pm.wrank = 1
			ORDER BY pm.lps ASC
			LIMIT " . $rptRecs;	
		break;
}
$result = mysql_query($select, $connection) or die(mysql_error());
?>

<table>
<tr>
<td class="tablehead" colspan="12"><?php echo $rptOption; ?></td>
</tr>
<tr>
<td class="colhead">Rank</td>
<td class="colhead">MatchID</td>
<td class="colhead">Date</td>


<td class="colhead">Player</td>
<td class="colhead">Match Type</td>
<td class="colhead">Time</td>
<td class="colhead">Lines</td>
<td class="colhead">LPS</td>
<td class="colhead">Grade</td>
<td class="colhead">WPTS</td>
<td class="colhead">EPTS</td>
<td class="colhead">POWER</td></tr>

<?php
$ct = 1;
while ($row = mysql_fetch_array($result))
{
	$mid = $row["matchid"];
	$date = $row["matchdate"];
	$player = $row["username"];
	$pid = $row["playerid"];
	$pCount = $row["pCt"];
	$lines = $row["lines"];
	$time = $row["time"];
	
	$wrank = $row["wrank"];
	$erank = $row["erank"];
	$pCt = $row["pCt"];
	
	$wpts = rankToPts($wrank, $pCt);
	$epts = rankToPts($erank, $pCt);
	$lps = number_format($lines/$time,3);
	$grade = gradePerf($time, $lines);
	
	$min = intval($time/60);
	$sec = str_pad($time - $min*60, 2, "0", STR_PAD_LEFT);
	$timeStr = $min . ":" . $sec;
	
	$power = computePower($wpts, $epts, $lps);
	$rowArr = array($ct, $mid, $date, $player, $pCount, $timeStr, $lines, $lps, $grade, $wpts, $epts, $power);
	
	echo '<tr>';
	foreach ($rowArr as $ra)
	{
		if($ra == $player)
		{
			echo '<td class="data"><a href="playerinfo.php?playerid=' . $pid . '" target="_blank">' . $ra . '</a></td>';
		}
		elseif($ra == $mid)
		{
			echo '<td class="data"><a href="matchinfo.php?matchid=' . $mid . '">' . $ra . '</a></td>';
		}
		else
		{
			echo '<td class="data">' . $ra . '</td>';
		}
	}
	echo '</tr>';
	$ct++;
}

?>

</table>
</div>

<?php
} //end report body if -above this doesnt show unless $_GET["rptOption"] isset.

include_once("footer.php");
?>
</body>
</html>